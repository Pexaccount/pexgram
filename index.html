<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>PexåŒ¿åå…¨çƒèŠå¤©å®¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background:#f2f2f2; margin:0; padding:0;}
    #chat { max-width:600px; margin:0 auto; padding:10px;}
    #messages { background:#fff; height:70vh; overflow-y:auto; padding:10px; border-radius:5px;}
    .msg { margin-bottom:8px; font-size:14px;}
    .user { font-weight:bold;}
    #inputBox { display:flex; margin-top:10px;}
    #text { flex:1; padding:8px; font-size:16px;}
    button { padding:8px 15px; font-size:16px; cursor:pointer;}
  </style>
</head>
<body>

<div id="chat">
  <h2>ğŸŒ PexåŒ¿åå…¨çƒèŠå¤©å®¤</h2>
  <div id="messages"></div>

  <div id="inputBox">
    <input id="text" placeholder="è¾“å…¥æ¶ˆæ¯..." maxlength="100">
    <button id="sendBtn">å‘é€</button>
  </div>
</div>

<!-- Firebase v12 æ¨¡å—åŒ– SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, serverTimestamp, limitToLast, query } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAlOYUdwcNWWueaj7X9RdzzkAk_r-_JWL8",
    authDomain: "pexchatweb.firebaseapp.com",
    databaseURL: "https://pexchatweb-default-rtdb.firebaseio.com",
    projectId: "pexchatweb",
    storageBucket: "pexchatweb.firebasestorage.app",
    messagingSenderId: "157034955766",
    appId: "1:157034955766:web:076f39819c081d73b8fdd7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, 'messages');

  const username = "åŒ¿å_" + Math.floor(Math.random() * 10000);

  // å‘é€æ¶ˆæ¯
  const sendBtn = document.getElementById("sendBtn");
  const textInput = document.getElementById("text");

  sendBtn.addEventListener("click", () => {
    const text = textInput.value.trim();
    if (!text) return;

    push(messagesRef, {
      user: username,
      text: text,
      time: serverTimestamp()
    });

    textInput.value = "";
  });

  // å®æ—¶æ¥æ”¶æ¶ˆæ¯
  const recentMessagesQuery = query(messagesRef, limitToLast(100));

  onChildAdded(recentMessagesQuery, (snapshot) => {
    const msg = snapshot.val();
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<span class="user">${msg.user}</span>: ${msg.text}`;
    document.getElementById("messages").appendChild(div);
    document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
  });
</script>

</body>
</html>
